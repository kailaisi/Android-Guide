### 长参数

**特征**

一个方法有三个或者四个以上的参数。



![img](https://sourcemaking.com/images/refactoring-illustrations/2x/long-parameter-list-1.png)

**问题原因**

一个方法中如果融合了几种类型的算法的话，可能就会出现一长串的参数列表。一长串的参数主要用来控制执行哪种算法。

长参数列表也许是使类更加独立的副产品。例如。某个方法中用于创建特殊对象的代码，从当前的方法中移到了调用该方法的内部。这样的话，创建的对象就需要作为一个参数传递给该方法。这样的话，原始类就不需要关心对象之间的关系，依赖关系减少了。如果创建多个对象的话，那么就会形成一种长参数。

长参数是特别难以理解的，随着时间的增长，这些参数就变得难以使用。方法可以使用自己的对象数据，而不是一长串的参数。如果当前对象没有包含必须的数据，那么可以创建一个对象(它将获取必须的数据)作为方法的参数传递

**方法**

仔细检测参数，如果参数只是另一个对象的方法的调用结果。请使用**用方法调用代替参数法**。这个对象可以作为自己的类的字段，也可以作为方法参数传递。

![img](https://sourcemaking.com/images/refactoring-illustrations/2x/long-parameter-list-2.png)

* 与其将从另一个对象接收的一组数据作为参数传递，不如通过**保存整个对象法**将对象本身传递给方法。
* 如果有几个无关的参数，可以通过**引入参数对象法**来处理。

**效果**

* 更易读、更简短
* 重构可以暴漏出未注意到的重复代码。

**什么时候忽视这种优化**

如果这样做会导致类之间不必要的依赖关系，请不要移除参数。

### 解决方案

#### 用方法代替参数法

```java
int basePrice = quantity * itemPrice;
double seasonDiscount = this.getSeasonalDiscount();
double fees = this.getFees();
double finalPrice = discountedPrice(basePrice, seasonDiscount, fees);
```

问题：第二个方法的参数是其实是通过方法计算出来的，其实是没有必要的。其实可以在被调用的方法中调用这些方法

```java
int basePrice = quantity * itemPrice;
double finalPrice = discountedPrice(basePrice);
```

解决方法：将获取值的代码放入到*discountedPrice*中去处理。

##### 重构原因

一长串的参数是很难理解的。此外，对于方法的调用通常需要进行一些列的计算或者复杂的处理来获得对应的参数值。因此，如果通过一定的方式，可以在方法内部做处理的话，就可以去掉参数。

##### 好处

去除了不必要的参数，简化了方法的调用。

##### 弊端

你未来可能需要参数来满足其他需要，那么就必须要重写方法了。

##### 重构方法

1. 首先确保参数不是来自当前方法的参数，如果是的话，则无法移动代码。
2. 如果相关代码比单个方法或者函数调用更复杂，使用[提取法](https://sourcemaking.com/refactoring/extract-method)将这部分代码隔离开。
3. 将主方法中，使用参数的地方替换为参数值的获取的方法。
4. 使用[移除参数](https://sourcemaking.com/refactoring/remove-parameter)消除未使用的参数

#### 保存整个对象法

```java
int low = daysTempRange.getLow();
int high = daysTempRange.getHigh();
boolean withinPlan = plan.withinRange(low, high);
```

问题：从一个对象中获取多个值，然后将它们作为参数传递给方法。

```java
boolean withinPlan = plan.withinRange(daysTempRange);
```

解决方法：尝试传递整个对象。

##### 重构原因

每次调用方法之前，都必须调用未来参数对象的方法。如果这些方法或为该方法获得的数据的数量发生了变化，您将需要在程序中仔细地找到十几个这样的位置，并在每个位置中实现这些更改。

应用这种重构技术后，获取所有必要数据的代码将存储在一个地方--方法本身。

##### 好处

- 看到的不是大量的参数，而是具有可理解名称的单个对象。
- 如果该方法需要来自对象的更多数据，则无需重写使用该方法的所有位置--仅在方法本身内修改即可。

##### 弊端

有时，这种转换会导致方法变得不那么灵活：以前，该方法可以从许多不同的源获取数据，但是现在，由于重构，我们将它的使用限制在具有特定接口的对象上。

##### 重构方法

1. 在方法中为对象创建一个参数，从中获取必要的值。
2. 现在开始逐个从方法中删除旧参数，代之以调用参数对象的相关方法。每次更换参数后测试程序。
3. 从方法调用之前的参数对象中删除getter代码。

#### 引入参数对象法

![img](http://cdn.qiniu.kailaisii.com/typora/202006/01/174547-809764.png)

问题：方法中包含了重复的参数

![img](http://cdn.qiniu.kailaisii.com/typora/202006/01/174603-201974.png)

解决方法：用对象代替参数

##### 重构原因

在多个方法中经常会遇到相同的一组参数。这会导致参数本身和相关操作的代码重复。通过在单个类中合并参数，还可以将处理此数据的方法移到那里，从而将其他方法从此代码中解放出来。

##### 好处

* 更易读的代码。看到的不再是大量的参数，而是具有可理解名称的单个对象
* 分散在各处的相同的参数组创建了它们自己的代码复制类型：虽然没有调用相同的代码，但经常会遇到相同的参数和参数组

##### 弊端

- 如果您只将数据移动到一个新的类中，并且不打算将任何行为或相关操作移到新类中，这个类看起来像[数据类]

##### 重构方法

1. 创建一个表示参数组的新类。使类不可变。
2. 在要重构的方法中，使用[添加参数法](https://sourcemaking.com/refactoring/add-parameter)，传递参数对象。在所有方法调用中，将从旧方法使用参数创建的对象传递给此参数。
3. 逐个从方法中删除旧参数，用参数对象的字段替换代码中的旧参数。在每个参数替换后测试程序。
4. 完成后，查看是否有必要将方法的一部分(有时甚至整个方法)移动到参数对象类。如果是，请使用[移动法](https://sourcemaking.com/refactoring/move-method)或[提取法](https://sourcemaking.com/refactoring/extract-method).